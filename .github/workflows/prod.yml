name: Deploy React App

on:
  push:
    branches:
      - main


env:
  FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3

    - name: Cache node_modules
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-npm-

    - name: Build React app
      run: |
        npm ci
        npm run build

    # - name: Upload build files to shared hosting
    #   uses: samhagon/ftp-action@v2
    #   with:
    #     host: ${{ secrets.FTP_HOST }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ env.FTP_PASSWORD }}
    #     localPath: ./build/
    #     remotePath:  /public_html/Testupload
    #     mode: upload
    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@4.3.3
      with:
        server:  ftp.firstmedtrade.com
        username:  ${{ secrets.FTP_USERNAME }}
        password:   ${{ secrets.FTP_PASSWORD }}
        protocol: ftps
        local-dir: ./build/
        server-dir: /public_html/admin-public/admin_new
        # dry-run: true
